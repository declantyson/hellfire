/*! xl-platform-fighter 2016-09-10 */
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Character=function(){function a(b,c,d){_classCallCheck(this,a),this.game=b}return _createClass(a,[{key:"initialise",value:function(a){this.name=a.name,this.maxSpeed=a.maxSpeed/this.game.fps,this.acceleration=a.acceleration,this.deceleration=a.deceleration,this.turnDelay=a.turnDelay,this.hurtboxes=a.hurtboxes,this.weight=1/a.weight,this.airSpeed=a.airSpeed/this.game.fps,this.jumpPower=1/a.jumpPower,this.jumpHeight=a.jumpHeight,this.allowedJumps=a.allowedJumps,this.jumpThreshold=a.jumpThreshold,this.currentSpeed=0,this.currentFallSpeed=0,this.currentDir=a.currentDir,this.currentVerticalDir=1,this.jumpStart=this.hurtboxes[0].y,this.jumpsRemaining=a.allowedJumps}},{key:"drawActions",value:function(a){if(this.fall(a.gravity,a.floors),this.game.currentKeys[this.game.keyBindings.right]?(this.game.keyChanged&&1!==this.currentDir&&this.turn(1),this.move()):this.game.currentKeys[this.game.keyBindings.left]?(this.game.keyChanged&&this.currentDir!==-1&&this.turn(-1),this.move()):this.stop(),this.game.currentKeys[this.game.keyBindings.jump]&&this.jumpsRemaining>0){if(this.jumpsRemaining<this.allowedJumps&&this.hurtboxes[0].y>this.jumpStart-this.jumpThreshold)return;this.jumpStart=this.hurtboxes[0].y,this.currentVerticalDir=-1,this.jumpsRemaining--}}},{key:"move",value:function(){var a=this.maxSpeed;this.currentFallSpeed>0&&(a=this.airSpeed);var b=a/(this.acceleration*this.game.fps);this.currentSpeed<a&&(this.currentSpeed+=b);for(var c=0;c<this.hurtboxes.length;c++)this.hurtboxes[c].x+=this.currentDir*this.currentSpeed}},{key:"stop",value:function(){var a=this.maxSpeed/(this.deceleration*this.game.fps);this.currentFallSpeed>0&&(a/=3),this.currentSpeed>0&&(this.currentSpeed-=a,this.currentSpeed<0&&(this.currentSpeed=0));for(var b=0;b<this.hurtboxes.length;b++)this.hurtboxes[b].x+=this.currentDir*this.currentSpeed}},{key:"turn",value:function(a){if(0!==this.currentSpeed){var b=this.maxSpeed/(this.turnDelay*this.game.fps);this.currentSpeed>0&&(this.currentSpeed-=b,this.currentSpeed<0&&(this.currentSpeed=0)),0===this.currentSpeed&&(this.currentDir=a,this.game.keyChanged=!1)}}},{key:"fall",value:function(a,b){if(this.currentVerticalDir===-1)return void this.jump(a,b);for(var c=!1,d=0;d<this.hurtboxes.length;d++){for(var e=this.hurtboxes[d],f=0;f<b.length;f++){var g=b[f];e.y>=g.y&&(e.x>=g.x&&e.x<=g.x+g.width||e.x+e.width>=g.x&&e.x+e.width<=g.x+g.width)&&(c=!0,this.hurtboxes[0].y=g.y)}if(c){this.jumpsRemaining=this.allowedJumps,this.currentFallSpeed=0;break}this.jumpsRemaining===this.allowedJumps&&(this.jumpsRemaining=this.allowedJumps-1),this.currentFallSpeed+=a/(this.weight*this.game.fps),e.y+=this.currentFallSpeed}}},{key:"jump",value:function(a,b){this.hurtboxes[0].y>this.jumpStart-this.jumpHeight?(this.currentFallSpeed-=a/(this.jumpPower*this.game.fps),this.hurtboxes[0].y+=this.currentFallSpeed):this.currentVerticalDir=1}}]),a}(),Hurtbox=function a(b,c,d,e){_classCallCheck(this,a),this.x=b,this.y=c,this.width=d,this.height=e},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Game=function a(b,c,d,e){_classCallCheck(this,a),this.canvas=document.getElementById(b),this.canvas.width=c,this.canvas.height=d,this.fps=e,this.ctx=this.canvas.getContext("2d"),this.currentKeys=[],this.keyChanged=!1,this.keyBindings={left:37,jump:38,right:39}},Scene=function(){function a(b,c,d){_classCallCheck(this,a),this.game=b,this.stage=c,this.playerOne=d,setInterval(this.draw.bind(this),1e3/this.game.fps)}return _createClass(a,[{key:"draw",value:function(){var a=document.createElement("canvas"),b=a.getContext("2d");a.height=this.game.canvas.height,a.width=this.game.canvas.width,this.game.ctx.clearRect(0,0,this.game.canvas.width,this.game.canvas.height),this.drawStageFloors(b),this.drawCharacters(b),this.characterActions(this.playerOne),this.game.ctx.drawImage(a,0,0)}},{key:"drawStageFloors",value:function(a){for(var b=0;b<this.stage.floors.length;b++){var c=this.stage.floors[b];a.moveTo(c.x,c.y),a.lineTo(c.x+c.width,c.y),a.stroke()}}},{key:"drawCharacters",value:function(a){for(var b=0;b<this.playerOne.hurtboxes.length;b++){var c=this.playerOne.hurtboxes[b];a.rect(c.x,c.y-c.height,c.width,c.height),a.stroke()}}},{key:"characterActions",value:function(a){a.drawActions(this.stage)}}]),a}();document.onkeydown=function(a){activeGame.currentKeys[a.keyCode]||(activeGame.keyChanged=!0,activeGame.currentKeys[a.keyCode]=!0)},document.onkeyup=function(a){activeGame.currentKeys[a.keyCode]=!1};var Stage=function a(b,c,d,e){_classCallCheck(this,a),this.game=b,this.name=c,this.floors=d,this.gravity=e/this.game.fps},Floor=function a(b,c,d){_classCallCheck(this,a),this.x=b,this.y=c,this.width=d};