{"version":3,"sources":["../src/game.es6.js"],"names":["Game","element","width","height","fps","canvas","document","getElementById","ctx","getContext","currentKeys","keyChanged","startingStockCount","visibleHitboxes","players","setTimeout","clearInterval","window","drawScene","Player","character","keys","keyBindings","left","jump","right","attacks","basicAttack","strongAttack","Scene","game","stage","setInterval","draw","bind","pre_canvas","createElement","pre_ctx","clearRect","drawStageFloors","drawCharacters","drawCharacterDamage","drawCharacterStocks","i","length","characterActions","drawHitboxes","drawImage","floors","floor","moveTo","x","y","lineTo","stroke","font","p","fillText","damage","stocks","img","setAttribute","id","h","hurtboxes","hurtbox","rect","drawActions","hitbox","currentFrame","startFrame","endFrame","active","baseHurtbox","baseX","currentDir","dir","calculatedX","xOffset","strokeStyle","yOffset","onkeydown","e","activeGame","keyCode","onkeyup"],"mappings":"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","file":"game.js","sourcesContent":["/*\n *\n *\tXL Platform Fighter/Game\n *\tXL Gaming/Declan Tyson\n *\tv0.0.45\n *\t23/09/2016\n *\n */\n\nclass Game {\n    constructor(element, width, height, fps) {\n        this.canvas = document.getElementById(element);\n        this.canvas.width = width;\n        this.canvas.height = height;\n        this.fps = fps;\n        this.ctx = this.canvas.getContext(\"2d\");\n        this.currentKeys = [];\n        this.keyChanged = false;\n        this.startingStockCount = 4;\n        this.visibleHitboxes = {};\n\n        this.players = [];\n    }\n\n    gameOver() {\n        setTimeout(function () {\n            // TODO: Go to victory screen\n            clearInterval(window.drawScene);\n        }, 100);\n    }\n}\n\nclass Player {\n    constructor(character, keys) {\n        this.character = character;\n        this.character.keyBindings = {\n            left  : keys.left,\n            jump  : keys.jump,\n            right : keys.right,\n            attacks: {\n                basicAttack: keys.basicAttack,\n                strongAttack: keys.strongAttack\n            }\n        };\n    }\n}\n\nclass Scene {\n    constructor(game, stage, players) {\n        this.game = game;\n        this.stage = stage;\n        this.players = players;\n\n        this.game.players = players;\n        window.drawScene = setInterval(this.draw.bind(this), 1000 / this.game.fps);\n    }\n\n    draw() {\n        var pre_canvas = document.createElement('canvas'),\n            pre_ctx = pre_canvas.getContext('2d');\n        pre_canvas.height = this.game.canvas.height;\n        pre_canvas.width = this.game.canvas.width;\n\n        this.game.ctx.clearRect(0, 0, this.game.canvas.width, this.game.canvas.height);\n\n        this.drawStageFloors(pre_ctx);\n        this.drawCharacters(pre_ctx);\n        this.drawCharacterDamage(pre_ctx);\n        this.drawCharacterStocks(pre_ctx);\n        for(var i = 0; i < this.players.length; i++) {\n            this.characterActions(this.players[i].character);\n            this.drawHitboxes(pre_ctx, this.players[i].character);\n        }\n\n        this.game.ctx.drawImage(pre_canvas, 0, 0);\n    }\n\n    drawStageFloors(pre_ctx) {\n        for (var i = 0; i < this.stage.floors.length; i++) {\n            var floor = this.stage.floors[i];\n\n            pre_ctx.moveTo(floor.x, floor.y);\n            pre_ctx.lineTo(floor.x + floor.width, floor.y);\n            pre_ctx.stroke();\n        }\n    }\n\n    drawCharacterDamage(pre_ctx) {\n        pre_ctx.font = \"Helvetica Neue Light 20px\";\n        for (var p = 0; p < this.players.length; p++) {\n            pre_ctx.fillText(this.players[p].character.damage + \"%\", (p * 200) + 32, 90);\n        }\n    }\n\n    drawCharacterStocks(pre_ctx) {\n        for (var p = 0; p < this.players.length; p++) {\n            for (var i = 0; i < this.players[p].character.stocks; i++) {\n                var img = document.createElement('img');\n                img.setAttribute(\"src\", \"/stock-icons/\" + this.players[p].character.id + \".png\");\n                pre_ctx.drawImage(img, (p * 200) + 32 + (40 * i), 32);\n            }\n        }\n    }\n\n    drawCharacters(pre_ctx) {\n        for (var i = 0; i < this.players.length; i++) {\n            for (var h = 0; h < this.players[i].character.hurtboxes.length; h++) {\n                var hurtbox = this.players[i].character.hurtboxes[h];\n                pre_ctx.rect(hurtbox.x, hurtbox.y - hurtbox.height, hurtbox.width, hurtbox.height);\n                pre_ctx.stroke();\n            }\n        }\n    }\n\n    characterActions(character) {\n        character.drawActions(this.stage);\n    }\n\n    drawHitboxes(pre_ctx, character) {\n        for (var h = 0; h < character.visibleHitboxes.length; h++) {\n            var hitbox = character.visibleHitboxes[h];\n            hitbox.currentFrame++;\n            if(hitbox.currentFrame >= hitbox.startFrame && hitbox.currentFrame <= hitbox.endFrame) {\n                hitbox.active = true;\n            } else if(hitbox.currentFrame > hitbox.endFrame) {\n                hitbox.active = false;\n            }\n\n            if(!hitbox.active) continue;\n\n            var baseHurtbox = character.hurtboxes[0];\n            var baseX = baseHurtbox.x;\n            if(character.currentDir == 1) {\n                baseX += baseHurtbox.width;\n            } else {\n                baseX -= baseHurtbox.width;\n            }\n\n            hitbox.dir = character.currentDir;\n            hitbox.calculatedX = baseX + (hitbox.xOffset * character.currentDir);\n\n            pre_ctx.strokeStyle = \"#FF0000\";\n            pre_ctx.rect(hitbox.calculatedX, baseHurtbox.y - hitbox.yOffset, hitbox.width, hitbox.height);\n            pre_ctx.stroke();\n            pre_ctx.strokeStyle = \"#000000\";\n        }\n    }\n}\n\ndocument.onkeydown = function (e) {\n    if(!activeGame.currentKeys[e.keyCode]) {\n        activeGame.keyChanged = true;\n        activeGame.currentKeys[e.keyCode] = true;\n    }\n};\n\ndocument.onkeyup = function (e) {\n    activeGame.currentKeys[e.keyCode] = false;\n};"]}