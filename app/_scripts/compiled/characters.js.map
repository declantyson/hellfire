{"version":3,"sources":["../src/characters.es6.js"],"names":["Character","game","startPosY","startPosX","opts","name","maxSpeed","fps","acceleration","deceleration","turnDelay","hurtboxes","weight","airSpeed","jumpPower","jumpHeight","allowedJumps","jumpThreshold","currentSpeed","currentFallSpeed","currentDir","currentVerticalDir","jumpStart","y","jumpsRemaining","jumpHeld","jumping","stage","fall","gravity","floors","currentKeys","keyBindings","right","keyChanged","turn","move","left","stop","jump","up","down","maxMovementSpeed","i","length","x","dir","console","log","hitFloor","h","hurtbox","f","floor","height","width","Hurtbox"],"mappings":"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","file":"characters.js","sourcesContent":["/*\n *\n *\tXL Platform Fighter/Characters\n *\tXL Gaming/Declan Tyson\n *\tv0.0.29\n *\t13/09/2016\n *\n */\n\nclass Character {\n    constructor(game, startPosY, startPosX) {\n        this.game = game;\n    }\n\n    initialise(opts) {\n        // attributes\n        this.name = opts.name;\n        this.maxSpeed = opts.maxSpeed / this.game.fps;\n        this.acceleration = opts.acceleration;\n        this.deceleration = opts.deceleration;\n        this.turnDelay = opts.turnDelay;\n        this.hurtboxes = opts.hurtboxes;\n        this.weight = 1/opts.weight;\n        this.airSpeed = opts.airSpeed / this.game.fps;\n        this.jumpPower = 1/opts.jumpPower;\n        this.jumpHeight = opts.jumpHeight;\n        this.allowedJumps = opts.allowedJumps;\n        this.jumpThreshold = opts.jumpThreshold;\n\n        // state\n        this.currentSpeed = 0;\n        this.currentFallSpeed = 0;\n        this.currentDir = opts.currentDir;\n        this.currentVerticalDir = 1;\n        this.jumpStart = this.hurtboxes[0].y;\n        this.jumpsRemaining = opts.allowedJumps;\n        this.jumpHeld = false;\n        this.jumping = false;\n    }\n    \n    drawActions(stage) {\n\n        this.fall(stage.gravity, stage.floors);\n\n        if(this.game.currentKeys[this.game.keyBindings.right]) {\n            if (this.game.keyChanged && this.currentDir !== 1) {\n                this.turn(1);\n            }\n            this.move();\n        } else if (this.game.currentKeys[this.game.keyBindings.left]) {\n            if (this.game.keyChanged && this.currentDir !== -1) {\n                this.turn(-1);\n            }\n            this.move();\n        } else {\n            this.stop();\n        }\n\n        if (this.game.currentKeys[this.game.keyBindings.jump]) {\n            if(this.jumpHeld) return;\n            this.jumpHeld = true;\n            if (this.jumpsRemaining > 0) {\n                if (\n                    (this.currentVerticalDir === -1 &&\n                    this.jumpsRemaining < this.allowedJumps &&\n                    this.hurtboxes[0].y > this.jumpStart - this.jumpThreshold.up)\n                        ||\n                    (this.currentVerticalDir === 1 &&\n                    this.jumpsRemaining < this.allowedJumps &&\n                    this.hurtboxes[0].y > this.jumpStart - this.jumpThreshold.down)\n                ) {\n                    return;\n                }\n                this.jumpStart = this.hurtboxes[0].y;\n                this.currentVerticalDir = -1;\n                this.jumpsRemaining--;\n            }\n        } else {\n            this.jumpHeld = false;\n        }\n    }\n\n    move() {\n        var maxMovementSpeed = this.maxSpeed;\n        if(this.currentFallSpeed > 0) maxMovementSpeed = this.airSpeed;\n\n        var acceleration = maxMovementSpeed / (this.acceleration * this.game.fps);\n        if(this.currentSpeed < maxMovementSpeed) {\n            this.currentSpeed += acceleration;\n        }\n\n        for(let i = 0; i < this.hurtboxes.length; i++) {\n            this.hurtboxes[i].x += this.currentDir * this.currentSpeed;\n        }\n    }\n\n    stop() {\n        var deceleration = this.maxSpeed / (this.deceleration * this.game.fps);\n        if(this.currentFallSpeed > 0) {\n            deceleration = deceleration / 3;\n        }\n\n        if(this.currentSpeed > 0) {\n            this.currentSpeed -= deceleration;\n            if(this.currentSpeed < 0) this.currentSpeed = 0;\n        }\n\n        for(let i = 0; i < this.hurtboxes.length; i++) {\n            this.hurtboxes[i].x += this.currentDir * this.currentSpeed;\n        }\n    }\n\n    turn(dir) {\n        if(this.currentSpeed === 0) return;\n\n        let deceleration = this.maxSpeed / (this.turnDelay * this.game.fps);\n        if(this.currentSpeed > 0) {\n            this.currentSpeed -= deceleration;\n            if(this.currentSpeed < 0) this.currentSpeed = 0;\n        }\n\n        if(this.currentSpeed === 0) {\n            this.currentDir = dir;\n            this.game.keyChanged = false;\n        }\n    }\n\n    fall(gravity, floors) {\n        if(this.currentVerticalDir === -1) {\n            this.jump(gravity, floors);\n            return;\n        }\n\n        console.log(this.currentFallSpeed);\n        if(this.currentFallSpeed > 0) {\n            this.jumping = false;\n        }\n\n        var hitFloor = false;\n\n        for(let h = 0; h < this.hurtboxes.length; h++) {\n            let hurtbox = this.hurtboxes[h];\n\n            for(let f = 0; f < floors.length; f++) {\n                let floor = floors[f];\n                if(\n                    !this.jumping &&\n                    (hurtbox.y >= floor.y && this.currentVerticalDir === 1) &&\n                    ((hurtbox.y - hurtbox.height <= floor.y)) &&\n                    ((hurtbox.x >= floor.x && hurtbox.x <= floor.x + floor.width) ||\n                    (hurtbox.x + hurtbox.width >= floor.x && hurtbox.x + hurtbox.width <= floor.x + floor.width))\n                ) {\n                    hitFloor = true;\n                    this.hurtboxes[0].y = floor.y;\n                }\n            }\n            if(hitFloor) {\n                this.jumpsRemaining = this.allowedJumps;\n                this.currentFallSpeed = 0;\n                break;\n            } else if(this.jumpsRemaining === this.allowedJumps) {\n                this.jumpsRemaining = this.allowedJumps - 1;\n            }\n\n            this.currentFallSpeed += gravity / (this.weight * this.game.fps);\n            hurtbox.y += this.currentFallSpeed;\n        }\n    }\n    \n    jump(gravity, floors) {\n        if(this.hurtboxes[0].y > this.jumpStart - this.jumpHeight) {\n            this.currentFallSpeed -= gravity / (this.jumpPower * this.game.fps);\n            this.hurtboxes[0].y += this.currentFallSpeed;\n            this.jumping = true;\n        } else {\n            this.currentVerticalDir = 1;\n        }\n    }\n}\n\nclass Hurtbox {\n    constructor(x, y, width, height) {\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n    }\n}\n"]}