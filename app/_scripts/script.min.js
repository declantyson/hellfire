/*! xl-platform-fighter 2016-09-09 */
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Character=function(){function a(b,c,d,e,f,g,h,i,j,k){_classCallCheck(this,a),this.game=b,this.name=c,this.maxSpeed=d/this.game.fps,this.acceleration=e,this.deceleration=f,this.turnDelay=i,this.hurtboxes=h,this.weight=j,this.airSpeed=k/this.game.fps,this.currentSpeed=0,this.currentFallSpeed=0,this.currentDir=g,this.currentVerticalDir=1}return _createClass(a,[{key:"move",value:function(){var a=this.maxSpeed;this.currentFallSpeed>0&&(a=this.airSpeed);var b=a/(this.acceleration*this.game.fps);this.currentSpeed<a&&(this.currentSpeed+=b);for(var c=0;c<this.hurtboxes.length;c++)this.hurtboxes[c].x+=this.currentDir*this.currentSpeed}},{key:"stop",value:function(){var a=this.maxSpeed/(this.deceleration*this.game.fps);this.currentFallSpeed>0&&(a/=3),this.currentSpeed>0&&(this.currentSpeed-=a,this.currentSpeed<0&&(this.currentSpeed=0));for(var b=0;b<this.hurtboxes.length;b++)this.hurtboxes[b].x+=this.currentDir*this.currentSpeed}},{key:"turn",value:function(a){if(0!==this.currentSpeed){var b=this.maxSpeed/(this.turnDelay*this.game.fps);this.currentSpeed>0&&(this.currentSpeed-=b,this.currentSpeed<0&&(this.currentSpeed=0)),0===this.currentSpeed&&(this.currentDir=a,this.game.keyChanged=!1)}}},{key:"fall",value:function(a,b){for(var c=!1,d=0;d<this.hurtboxes.length;d++){for(var e=this.hurtboxes[d],f=0;f<b.length;f++){var g=b[f];e.y==g.startY&&(e.x>=g.startX&&e.x<=g.endX||e.x+e.width>=g.startX&&e.x+e.width<=g.endX)&&(c=!0)}if(c){this.currentFallSpeed=0;break}console.log(this.currentFallSpeed),this.currentFallSpeed+=a/(this.weight*this.game.fps),e.y+=this.currentVerticalDir*this.currentFallSpeed}}}]),a}(),Hurtbox=function a(b,c,d,e){_classCallCheck(this,a),this.x=b,this.y=c,this.width=d,this.height=e},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Game=function a(b,c,d,e){_classCallCheck(this,a),this.canvas=document.getElementById(b),this.canvas.width=c,this.canvas.height=d,this.fps=e,this.ctx=this.canvas.getContext("2d"),this.currentKey=-1,this.keyChanged=!1},Scene=function(){function a(b,c,d){_classCallCheck(this,a),this.game=b,this.stage=c,this.playerOne=d,setInterval(this.draw.bind(this),1e3/this.game.fps)}return _createClass(a,[{key:"draw",value:function(){var a=document.createElement("canvas"),b=a.getContext("2d");a.height=this.game.canvas.height,a.width=this.game.canvas.width,this.game.ctx.clearRect(0,0,this.game.canvas.width,this.game.canvas.height),this.drawStageFloors(b),this.drawCharacters(b),this.characterActions(this.playerOne),this.game.ctx.drawImage(a,0,0)}},{key:"drawStageFloors",value:function(a){for(var b=0;b<this.stage.floors.length;b++){var c=this.stage.floors[b];a.moveTo(c.startX,c.startY),a.lineTo(c.endX,c.endY),a.stroke()}}},{key:"drawCharacters",value:function(a){for(var b=0;b<this.playerOne.hurtboxes.length;b++){var c=this.playerOne.hurtboxes[b];a.rect(c.x,c.y-c.height,c.width,c.height),a.stroke()}}},{key:"characterActions",value:function(a){if(a.fall(this.stage.gravity,this.stage.floors),"undefined"!=typeof keys[this.game.currentKey]){var b=keys[this.game.currentKey];"right"==b?(this.game.keyChanged&&1!==a.currentDir&&a.turn(1),a.move()):"left"==b?(this.game.keyChanged&&a.currentDir!==-1&&a.turn(-1),a.move()):"stop"==b&&a.stop()}}}]),a}(),keys={"-1":"stop",37:"left",39:"right"};document.onkeydown=function(a){activeGame.currentKey!==a.keyCode&&(activeGame.keyChanged=!0,activeGame.currentKey=a.keyCode)},document.onkeyup=function(){activeGame.currentKey=-1};var Stage=function a(b,c,d,e){_classCallCheck(this,a),this.game=b,this.name=c,this.floors=d,this.gravity=e/this.game.fps},Floor=function a(b,c,d,e){_classCallCheck(this,a),this.startX=b,this.startY=c,this.endX=d,this.endY=e};